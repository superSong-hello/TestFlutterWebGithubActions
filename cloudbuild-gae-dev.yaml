steps:
  # Install Flutter SDK && Build Flutter Web app
  - name: 'cirrusci/flutter'
    entrypoint: /bin/sh
    args:
    - '-c'
    - |
      dart pub global activate melos
      dart pub add melos --dev
      echo 'export PATH="$PATH":"$HOME/.pub-cache/bin"' >> ~/.bashrc
      source ~/.bashrc
      echo 'export PATH="$PATH":"$HOME/.pub-cache/bin"' >> ~/.bash_profile
      source ~/.bash_profile
      melos build:flutterWeb:dev
  # Upload to GAE
  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args:
    - '-c'
    - |
      cd packages/daifuku/
      gcloud app deploy app.yaml


#  # Install Flutter SDK && Build Flutter Web app
#  - name: 'cirrusci/flutter'
#    entrypoint: /bin/sh
#    args: ['-c', 'cd packages/daifuku/ && flutter clean && flutter pub get && flutter build web --dart-define=MODE=debug --base-href="/" --web-renderer html']
#  # Upload to GAE
#  - name: 'gcr.io/cloud-builders/gcloud'
#    entrypoint: 'bash'
#    args:
#      - '-c'
#      - |
#        cd packages/daifuku/
#        gcloud app deploy app.yaml